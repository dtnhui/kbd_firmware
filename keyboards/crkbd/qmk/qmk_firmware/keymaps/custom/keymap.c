/*
 * Copyright 2024 Danny Hui (@dtnhui)
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 2 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

#include QMK_KEYBOARD_H

enum layers {
    _QWERTY,    // Qwerty Layout
    _NAV,       // Navigation
    _NUM,       // Number & Symbol
    _KPAD,      // Keypad & Mouse
    _FUNC,      // Function
};

/* Layers */
#define MO_NAV      MO(_NAV)
#define MO_NUM      MO(_NUM)
#define MO_KPAD     MO(_KPAD)
#define MO_FUNC     MO(_FUNC)
/* One-shot Modifiers */
#define O_LSFT      OSM(MOD_LSFT)
#define O_LCTL      OSM(MOD_LCTL)
#define O_LALT      OSM(MOD_LALT)
#define O_LGUI      OSM(MOD_LGUI)
#define O_RSFT      OSM(MOD_RSFT)
#define O_RCTL      OSM(MOD_RCTL)
#define O_RALT      OSM(MOD_RALT)
#define O_RGUI      OSM(MOD_RGUI)
/* Thumb Row Mods */
#define LC_ESC      LCTL_T(KC_ESC)
#define NUM_SPC     LT(_NUM, KC_SPC)
#define FUNC_SPC    LT(_FUNC, KC_SPC)
#define LS_TAB      LSFT_T(KC_TAB)
#define LS_ESC      LSFT_T(KC_ESC)
#define RS_BSPC     RSFT_T(KC_BSPC)
#define RS_DEL      RSFT_T(KC_DEL)
#define NAV_ENT     LT(_NAV, KC_ENT)
#define FUNC_ENT    LT(_FUNC, KC_ENT)
#define RC_DEL      RCTL_T(KC_DEL)
/* Home Row Mods */
#define LG_A        LGUI_T(KC_A)
#define LA_S        LALT_T(KC_S)
#define LC_D        LCTL_T(KC_D)
#define LS_F        LSFT_T(KC_F)
#define RS_J        RSFT_T(KC_J)
#define RC_K        RCTL_T(KC_K)
#define RA_L        RALT_T(KC_L)
#define RG_SCLN     RGUI_T(KC_SCLN)
#define LA_R        LALT_T(KC_R)
#define LC_S        LCTL_T(KC_S)
#define LS_T        LSFT_T(KC_T)
#define RS_N        RSFT_T(KC_N)
#define RC_E        RCTL_T(KC_E)
#define RA_I        RALT_T(KC_I)
#define RG_O        RGUI_T(KC_O)
#define LG_1        LGUI_T(KC_1)
#define LA_2        LALT_T(KC_2)
#define LC_3        LCTL_T(KC_3)
#define LS_4        LSFT_T(KC_4)
#define RS_7        RSFT_T(KC_7)
#define RC_8        RCTL_T(KC_8)
#define RA_9        RALT_T(KC_9)
#define RG_0        RGUI_T(KC_0)
/* Windows Hotkeys */
#define ALT_PSCR    A(KC_PSCR)
#define SG_S        S(G(KC_S))
#define CTL_INS     C(KC_INS)
#define SFT_INS     S(KC_INS)
#define ALT_SFT     A(KC_LSFT)
#define CG_LEFT     C(G(KC_LEFT))
#define CG_RGHT     C(G(KC_RGHT))
#define GUI_D       G(KC_D)
#define GUI_L       G(KC_L)
#define CA_DEL      C(A(KC_DEL))

const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
  [_QWERTY] = LAYOUT_split_3x6_3 (
  //|-----------------------------------------------------|                    |-----------------------------------------------------|
  //|   Tab  |    q   |    w   |    e   |    r   |    t   |                    |    y   |    u   |    i   |    o   |    p   | BSpace |
       KC_TAB,    KC_Q,    KC_W,    KC_E,    KC_R,    KC_T,                         KC_Y,    KC_U,    KC_I,    KC_O,   KC_P,  KC_BSPC,
  //|--------+--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------+--------|
  //|  Caps  |    a   |    s   |    d   |    f   |    g   |                    |    h   |    j   |    k   |    l   |   ;:   |   '"   |
      KC_CAPS,    LG_A,    LA_S,    LC_D,    LS_F,    KC_G,                         KC_H,    RS_J,    RC_K,    RA_L, RG_SCLN, KC_QUOT,
  //|--------+--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------+--------|
  //| LShift |    z   |    x   |    c   |    v   |    b   |                    |    n   |    m   |   ,<   |   .>   |   /?   | RShift |
      KC_LSFT,    KC_Z,    KC_X,    KC_C,    KC_V,    KC_B,                         KC_N,    KC_M, KC_COMM,  KC_DOT, KC_SLSH, KC_RSFT,
  //|--------+--------+--------+--------+--------+--------+--------|  |--------+--------+--------+--------+--------+--------+--------|
                                      //|   Esc  | L3(SPC)|   Tab  |  | BSpace | L2(ENT)| Delete |
                                           LC_ESC, NUM_SPC,  LS_TAB,    RS_BSPC, NAV_ENT,  RC_DEL
                                      //|--------------------------|  |--------------------------|
  ),

  [_NAV] = LAYOUT_split_3x6_3 (
  //|-----------------------------------------------------|                    |-----------------------------------------------------|
  //|   Esc  |        |  SG+s  |Alt+PSCR| Insert |        |                    |        | PageUp |   Up   |PageDown|        | Delete |
       KC_ESC, XXXXXXX,    SG_S,ALT_PSCR,  KC_INS, XXXXXXX,                      XXXXXXX, KC_PGUP,   KC_UP, KC_PGDN, XXXXXXX,  KC_DEL,
  //|--------+--------|--------+--------+--------+--------|                    |--------+--------+--------+--------+--------+--------|
  //|  Calc  |  LGUI  |  LALT  |  LCTL  |  LSFT  |        |                    |  Home  |  Left  |  Down  |  Right |   End  | Keypad |
      KC_CALC, KC_LGUI, KC_LALT, KC_LCTL, KC_LSFT, XXXXXXX,                      KC_HOME, KC_LEFT, KC_DOWN, KC_RGHT,  KC_END, MO_KPAD,
  //|--------+--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------+--------|
  //|        |        |        | LC+INS | LS+INS |        |                    |        | CG+Left| LGUI+D |CG+Right|        |        |
      _______, XXXXXXX, XXXXXXX, CTL_INS, SFT_INS, XXXXXXX,                      XXXXXXX, CG_LEFT,   GUI_D, CG_RGHT, XXXXXXX, _______,
  //|--------+--------+--------+--------+--------+--------+--------|  |--------+--------+--------+--------+--------+--------+--------|
                                      //|        |Tri(SPC)|        |  |        |        |        |
                                          _______,FUNC_SPC, _______,    XXXXXXX, XXXXXXX, XXXXXXX
                                      //|--------------------------|  |--------------------------|
  ),

  [_NUM] = LAYOUT_split_3x6_3 (
  //|-----------------------------------------------------|                    |-----------------------------------------------------|
  //|        |   `~   |   [{   |        |        |        |                    |        |   -_   |   =+   |   ]}   |   \|   |        |
      _______,  KC_GRV, KC_LBRC, XXXXXXX, XXXXXXX, XXXXXXX,                      XXXXXXX, KC_MINS,  KC_EQL, KC_RBRC, KC_BSLS, _______,
  //|--------+--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------+--------|
  //| Keypad |   1!   |   2@   |   3#   |   4$   |   5%   |                    |   6^   |   7&   |   8*   |   9(   |   0)   |        |
      MO_KPAD,    LG_1,    LA_2,    LC_3,    LS_4,    KC_5,                         KC_6,    RS_7,    RC_8,    RA_9,    RG_0, _______,
  //|--------+--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------+--------|
  //|        |        |        |        |        |        |                    |        |        |        |        |        |        |
      _______, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,                      XXXXXXX, XXXXXXX, _______, _______, _______, _______,
  //|--------+--------+--------+--------+--------+--------+--------|  |--------+--------+--------+--------+--------+--------+--------|
                                      //|        |        |        |  |        |Tri(ENT)|        |
                                          XXXXXXX, XXXXXXX, XXXXXXX,    _______,FUNC_ENT, _______
                                      //|--------------------------|  |--------------------------|
  ),

  [_KPAD] = LAYOUT_split_3x6_3 (
  //|-----------------------------------------------------|                    |-----------------------------------------------------|
  //|        |        |        |        |        |        |                    |    /   |    7   |    8   |    9   |    *   |        |
      XXXXXXX, XXXXXXX, KC_WH_D, KC_MS_U, KC_WH_U, XXXXXXX,                      KC_SLSH,    KC_7,    KC_8,    KC_9, KC_ASTR, XXXXXXX,
  //|--------+--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------+--------|
  //|        |        |        |        |        |        |                    |    -   |    4   |    5   |    6   |    +   |        |
      XXXXXXX, XXXXXXX, KC_MS_L, KC_MS_D, KC_MS_R, XXXXXXX,                      KC_MINS,    KC_4,    KC_5,    KC_6, KC_PLUS, XXXXXXX,
  //|--------+--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------+--------|
  //|        |        |        |        |        |        |                    |   Esc  |    1   |    2   |    3   |  Enter |        |
      XXXXXXX, XXXXXXX, KC_WH_L, KC_BTN3, KC_WH_R, XXXXXXX,                       KC_ESC,    KC_1,    KC_2,    KC_3,  KC_ENT, XXXXXXX,
  //|--------+--------+--------+--------+--------+--------+--------|  |--------+--------+--------+--------+--------+--------+--------|
                                      //|        |        |        |  | BSpace |    0   |    .   |
                                          XXXXXXX, KC_BTN1, KC_BTN2,    KC_BSPC,    KC_0,  KC_DOT
                                      //|--------------------------|  |--------------------------|
  ),

  [_FUNC] = LAYOUT_split_3x6_3 (
  //|-----------------------------------------------------|                    |-----------------------------------------------------|
  //|        |   F1   |   F2   |   F3   |   F4   | Speed+ |                    |  Hue+  | LGUI+L |        |        | CA+DEL |        |
      XXXXXXX,   KC_F1,   KC_F2,   KC_F3,   KC_F4, RGB_SPI,                      RGB_HUI,   GUI_L, XXXXXXX, XXXXXXX,  CA_DEL, XXXXXXX,
  //|--------+--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------+--------|
  //|        |   F5   |   F6   |   F7   |   F8   | Rainbow|                    | Breath |  RSFT  |  RCTL  |  RALT  |  RGUI  |        |
      XXXXXXX,   KC_F5,   KC_F6,   KC_F7,   KC_F8, RGB_M_R,                      RGB_M_B, KC_RSFT, KC_RCTL, KC_RALT, KC_RGUI, XXXXXXX,
  //|--------+--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------+--------|
  //|        |   F9   |   F10  |   F11  |   F12  | Speed- |                    |  Hue-  |  Mute  |  Vol-  |  Vol+  |LA+Shift|        |
      XXXXXXX,   KC_F9,  KC_F10,  KC_F11,  KC_F12, RGB_SPD,                      RGB_HUD, KC_MUTE, KC_VOLD, KC_VOLU, ALT_SFT, XXXXXXX,
  //|--------+--------+--------+--------+--------+--------+--------|  |--------+--------+--------+--------+--------+--------+--------|
                                      //| Bright-|        | Bright+|  | On/Off |        |  Plain |
                                          RGB_VAD, XXXXXXX, RGB_VAI,    RGB_TOG, XXXXXXX, RGB_M_P
                                      //|--------------------------|  |--------------------------|
  )
};

const key_override_t delete_key_override = ko_make_basic(MOD_MASK_SHIFT, KC_BSPC, KC_DELETE);

// This globally defines all key overrides to be used
const key_override_t **key_overrides = (const key_override_t *[]){
    &delete_key_override,
    NULL // Null terminate the array of overrides!
};

#ifdef OLED_ENABLE
#define ANIM_FRAME_DURATION 100 // in units of milliseconds

oled_rotation_t oled_init_user(oled_rotation_t rotation) {
    return OLED_ROTATION_270;
}

static void oled_render_matrix_rain(void) {
    static const char PROGMEM BASE58_CHAR[] = {
        '1', '2', '3', '4', '5', '6', '7', '8', '9', 'A', 'B', 'C', 'D', 'E', 'F', 'G',
        'H', 'J', 'K', 'L', 'M', 'N', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y',
        'Z', 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'm', 'n', 'o', 'p',
        'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z'
    };
    static uint32_t anim_timer = 0;
    static uint32_t frame = 0;
    static bool rain_dropped[5] = {false};
    static int32_t rain_y[5] = {0};
    static uint32_t rain_len[5] = {0};
    static uint32_t tail_y[5] = {0};
    static uint32_t rain_speed[5] = {0};

    /* Display Off */
    if (!is_oled_on()) {
        oled_clear();
        anim_timer = 0;
        frame = 0;
        for (uint32_t i = 0; i < oled_max_chars(); i++) {
            rain_dropped[i] = false;
        }
        return;
    }

    /* Character Spinning */
    if (timer_elapsed32(anim_timer) < ANIM_FRAME_DURATION) {
        for (uint32_t i = 0; i < oled_max_chars(); i++) {
            if (rain_y[i] < 0) {
                // Out of Display
            } else if (rain_y[i] < oled_max_lines()) {
                oled_set_cursor(i, rain_y[i]);
                oled_write_char(BASE58_CHAR[rand() % sizeof(BASE58_CHAR)], false);
            }
        }
        return;
    }

    /* New frame */
    frame++;
    anim_timer = timer_read32();
    for (uint32_t i = 0; i < oled_max_chars(); i++) {
        /* Re-Initialization */
        if (!rain_dropped[i]) {
            rain_dropped[i] = true;
            rain_y[i] = 0 - (rand() % oled_max_lines() / 2);
            rain_len[i] = (oled_max_lines() / 4) + (rand() % oled_max_lines() / 2);
            tail_y[i] = 0;
            rain_speed[i] = 1 + (rand() % oled_max_chars() / 2);
        }
        /* Rain */
        if ((frame % rain_speed[i]) == 0) {
            if (rain_y[i] < 0) {
                // Out of Display
            } else if (rain_y[i] > rain_len[i]) {
                if (tail_y[i] < oled_max_lines()) {
                    oled_set_cursor(i, tail_y[i]++);
                    oled_write_char(' ', false);
                }
            }
            if (rain_y[i]++ == (oled_max_lines() + rain_len[i])) {
                rain_dropped[i] = false;
            }
            /* Glitch */
            uint32_t glitch_total = rand() % rain_len[i];
            for (uint32_t j = 0; j < glitch_total; j++) {
                if ((rain_y[i] > 0) && (tail_y[i] < oled_max_lines())) {
                    uint32_t glitch_y = tail_y[i] + (rand() % (rain_y[i] - tail_y[i]));
                    if (glitch_y < oled_max_lines()) {
                        oled_set_cursor(i, glitch_y);
                        oled_write_char(BASE58_CHAR[rand() % sizeof(BASE58_CHAR)], false);
                    }
                }
            }
        }
    }
}

void oled_render_4layers_state(void) {
    /* 32 x 32 pixels */
    static const char PROGMEM layer_inactive[128] = {
        0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0x18, 0x04, 0x04, 0x04, 0x04, 0x04, 0x08, 0x08, 0x08, 0x08,
        0x08, 0x08, 0x08, 0x08, 0x04, 0x04, 0x04, 0x04, 0x04, 0x18, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x80, 0x78, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x78, 0x80, 0x00, 0x00,
        0x00, 0x00, 0x0f, 0x08, 0x08, 0x08, 0xc8, 0xe8, 0xe8, 0xf8, 0xe8, 0xe8, 0xe8, 0xe8, 0xe8, 0xe8,
        0xe8, 0xe8, 0xe8, 0xe8, 0xe8, 0xe8, 0xf8, 0xe8, 0xe8, 0xc8, 0x08, 0x08, 0x08, 0x0f, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x38, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f,
        0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x38, 0x00, 0x00, 0x00, 0x00
    };
    /* 32 x 32 pixels */
    static const char PROGMEM layer_pressed[4][2][128] = {
        { /* Layer i */
            { /* lower */
                0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x80, 0x70, 0x0c, 0x02, 0x02, 0x02, 0x02, 0x02, 0x04, 0x04, 0x04, 0x64,
                0x64, 0x04, 0x04, 0x04, 0x02, 0x02, 0x02, 0x02, 0x02, 0x0c, 0x70, 0x80, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0xc0, 0x3c, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x41, 0x7f,
                0x7f, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x3c, 0xc0, 0x00, 0x00,
                0x00, 0x00, 0x07, 0x04, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c,
                0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x04, 0x07, 0x00, 0x00
            },
            { /* upper */
                0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x80, 0x70, 0x8c, 0xf2, 0xfa, 0xfa, 0xfa, 0xfa, 0xf4, 0xf4, 0xb4, 0x34,
                0x34, 0xb4, 0xf4, 0xf4, 0xfa, 0xfa, 0xfa, 0xfa, 0xf2, 0x8c, 0x70, 0x80, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0xc0, 0x3c, 0xc3, 0xfc, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xbf, 0x80,
                0x80, 0xbf, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfc, 0xc3, 0x3c, 0xc0, 0x00, 0x00,
                0x00, 0x00, 0x07, 0x04, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d,
                0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x04, 0x07, 0x00, 0x00
            },
        },
        { /* Layer ii */
            { /* lower */
                0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x80, 0x70, 0x0c, 0x02, 0x02, 0x02, 0x02, 0x02, 0x04, 0x64, 0x64, 0x04,
                0x04, 0x64, 0x64, 0x04, 0x02, 0x02, 0x02, 0x02, 0x02, 0x0c, 0x70, 0x80, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0xc0, 0x3c, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x41, 0x7f, 0x7f, 0x40,
                0x41, 0x7f, 0x7f, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x3c, 0xc0, 0x00, 0x00,
                0x00, 0x00, 0x07, 0x04, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c,
                0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x04, 0x07, 0x00, 0x00
            },
            { /* upper */
                0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x80, 0x70, 0x8c, 0xf2, 0xfa, 0xfa, 0xfa, 0xfa, 0xb4, 0x34, 0x34, 0xb4,
                0xb4, 0x34, 0x34, 0xb4, 0xfa, 0xfa, 0xfa, 0xfa, 0xf2, 0x8c, 0x70, 0x80, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0xc0, 0x3c, 0xc3, 0xfc, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xbf, 0x80, 0x80, 0xbf,
                0xbf, 0x80, 0x80, 0xbf, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfc, 0xc3, 0x3c, 0xc0, 0x00, 0x00,
                0x00, 0x00, 0x07, 0x04, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d,
                0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x04, 0x07, 0x00, 0x00
            },
        },
        { /* Layer iii */
            { /* lower */
                0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x80, 0x70, 0x0c, 0x02, 0x02, 0x02, 0x02, 0x62, 0x64, 0x04, 0x04, 0x64,
                0x64, 0x04, 0x04, 0x64, 0x62, 0x02, 0x02, 0x02, 0x02, 0x0c, 0x70, 0x80, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0xc0, 0x3c, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x41, 0x7f, 0x7f, 0x40, 0x41, 0x7f,
                0x7f, 0x40, 0x41, 0x7f, 0x7f, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x3c, 0xc0, 0x00, 0x00,
                0x00, 0x00, 0x07, 0x04, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c,
                0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x04, 0x07, 0x00, 0x00
            },
            { /* upper */
                0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x80, 0x70, 0x8c, 0xf2, 0xfa, 0xfa, 0xba, 0x3a, 0x34, 0xb4, 0xb4, 0x34,
                0x34, 0xb4, 0xb4, 0x34, 0x3a, 0xba, 0xfa, 0xfa, 0xf2, 0x8c, 0x70, 0x80, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0xc0, 0x3c, 0xc3, 0xfc, 0xff, 0xff, 0xff, 0xff, 0xbf, 0x80, 0x80, 0xbf, 0xbf, 0x80,
                0x80, 0xbf, 0xbf, 0x80, 0x80, 0xbf, 0xff, 0xff, 0xff, 0xff, 0xfc, 0xc3, 0x3c, 0xc0, 0x00, 0x00,
                0x00, 0x00, 0x07, 0x04, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d,
                0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x04, 0x07, 0x00, 0x00
            },
        },
        { /* Layer iv */
            { /* lower */
                0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x80, 0x70, 0x0c, 0x02, 0x02, 0x02, 0x02, 0x62, 0x64, 0x04, 0x04, 0x04,
                0x04, 0x04, 0x04, 0x04, 0x02, 0x02, 0x02, 0x02, 0x02, 0x0c, 0x70, 0x80, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0xc0, 0x3c, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x41, 0x7f, 0x7f, 0x40, 0x00, 0x03,
                0x1f, 0x78, 0x40, 0x78, 0x1f, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x3c, 0xc0, 0x00, 0x00,
                0x00, 0x00, 0x07, 0x04, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c,
                0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x04, 0x07, 0x00, 0x00
            },
            { /* upper */
                0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x80, 0x70, 0x8c, 0xf2, 0xfa, 0xfa, 0xba, 0x3a, 0x34, 0xb4, 0xf4, 0x34,
                0x34, 0xf4, 0xf4, 0xf4, 0x3a, 0x3a, 0xfa, 0xfa, 0xf2, 0x8c, 0x70, 0x80, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0xc0, 0x3c, 0xc3, 0xfc, 0xff, 0xff, 0xff, 0xff, 0xbf, 0x80, 0x80, 0xbf, 0xff, 0xfe,
                0xf0, 0x83, 0x9f, 0x83, 0xf0, 0xfe, 0xff, 0xff, 0xff, 0xff, 0xfc, 0xc3, 0x3c, 0xc0, 0x00, 0x00,
                0x00, 0x00, 0x07, 0x04, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d,
                0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x04, 0x07, 0x00, 0x00
            },
        },
    };
    uint32_t curr_layer = get_highest_layer(layer_state);
    led_t led_state = host_keyboard_led_state();
    for (uint32_t i = 0; i < 4; i++) {
        oled_set_cursor(0, i * 4);
        if (i == curr_layer) {
            oled_write_raw(layer_pressed[i][led_state.caps_lock], sizeof(layer_pressed[0][0]));
        } else {
            oled_write_raw(layer_inactive, sizeof(layer_inactive));
        }
    }
}

void oled_render_5layers_state(void) {
    /* 32 x 24 pixels */
    static const char PROGMEM layer_inactive[96] = {
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x30, 0x0c, 0x02, 0x02, 0x02, 0x02, 0x04, 0x04, 0x04,
        0x04, 0x04, 0x04, 0x02, 0x02, 0x02, 0x02, 0x0c, 0x30, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x78, 0x47, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0xc0, 0x40, 0x40,
        0x40, 0x40, 0xc0, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x47, 0x78, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x60, 0x78, 0x7e, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f,
        0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7e, 0x78, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
    };
    /* 32 x 32 pixels */
    static const char PROGMEM layer_pressed[5][2][128] = {
        { /* Layer i */
            { /* lower */
                0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x40, 0x40, 0x40, 0x40,
                0x40, 0x40, 0x40, 0x40, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0xc0, 0x38, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0xf6,
                0xf6, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x38, 0xc0, 0x00, 0x00,
                0x00, 0xfc, 0x83, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x8c, 0x8f,
                0x8f, 0x8c, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x83, 0xfc, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07,
                0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x00, 0x00, 0x00, 0x00
            },
            { /* upper */
                0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x20, 0xa0, 0xa0, 0xa0, 0xa0, 0xa0, 0x40, 0x40, 0x40, 0x40,
                0x40, 0x40, 0x40, 0x40, 0xa0, 0xa0, 0xa0, 0xa0, 0xa0, 0x20, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0xc0, 0x38, 0xc7, 0xf8, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf3, 0x03,
                0x03, 0xf3, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0xc7, 0x38, 0xc0, 0x00, 0x00,
                0x00, 0xfc, 0x83, 0xbc, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xb3, 0xb0,
                0xb0, 0xb3, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xbc, 0x83, 0xfc, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07,
                0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x00, 0x00, 0x00, 0x00
            },
        },
        { /* Layer ii */
            { /* lower */
                0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x40, 0x40, 0x40, 0x40,
                0x40, 0x40, 0x40, 0x40, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0xc0, 0x38, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0xf6, 0xf6, 0x00,
                0x30, 0xf6, 0xf6, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x38, 0xc0, 0x00, 0x00,
                0x00, 0xfc, 0x83, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x8c, 0x8f, 0x8f, 0x8c,
                0x8c, 0x8f, 0x8f, 0x8c, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x83, 0xfc, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07,
                0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x00, 0x00, 0x00, 0x00
            },
            { /* upper */
                0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x20, 0xa0, 0xa0, 0xa0, 0xa0, 0xa0, 0x40, 0x40, 0x40, 0x40,
                0x40, 0x40, 0x40, 0x40, 0xa0, 0xa0, 0xa0, 0xa0, 0xa0, 0x20, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0xc0, 0x38, 0xc7, 0xf8, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf3, 0x03, 0x03, 0xf3,
                0xf3, 0x03, 0x03, 0xf3, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0xc7, 0x38, 0xc0, 0x00, 0x00,
                0x00, 0xfc, 0x83, 0xbc, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xb3, 0xb0, 0xb0, 0xb3,
                0xb3, 0xb0, 0xb0, 0xb3, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xbc, 0x83, 0xfc, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07,
                0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x00, 0x00, 0x00, 0x00
            },
        },
        { /* Layer iii */
            { /* lower */
                0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x40, 0x40, 0x40, 0x40,
                0x40, 0x40, 0x40, 0x40, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0xc0, 0x38, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0xf6, 0xf6, 0x00, 0x30, 0xf6,
                0xf6, 0x00, 0x30, 0xf6, 0xf6, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x38, 0xc0, 0x00, 0x00,
                0x00, 0xfc, 0x83, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x8c, 0x8f, 0x8f, 0x8c, 0x8c, 0x8f,
                0x8f, 0x8c, 0x8c, 0x8f, 0x8f, 0x8c, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x83, 0xfc, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07,
                0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x00, 0x00, 0x00, 0x00
            },
            { /* upper */
                0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x20, 0xa0, 0xa0, 0xa0, 0xa0, 0xa0, 0x40, 0x40, 0x40, 0x40,
                0x40, 0x40, 0x40, 0x40, 0xa0, 0xa0, 0xa0, 0xa0, 0xa0, 0x20, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0xc0, 0x38, 0xc7, 0xf8, 0xff, 0xff, 0xff, 0xff, 0xf3, 0x03, 0x03, 0xf3, 0xf3, 0x03,
                0x03, 0xf3, 0xf3, 0x03, 0x03, 0xf3, 0xff, 0xff, 0xff, 0xff, 0xf8, 0xc7, 0x38, 0xc0, 0x00, 0x00,
                0x00, 0xfc, 0x83, 0xbc, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xb3, 0xb0, 0xb0, 0xb3, 0xb3, 0xb0,
                0xb0, 0xb3, 0xb3, 0xb0, 0xb0, 0xb3, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xbc, 0x83, 0xfc, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07,
                0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x00, 0x00, 0x00, 0x00
            },
        },
        { /* Layer iv */
            { /* lower */
                0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x40, 0x40, 0x40, 0x40,
                0x40, 0x40, 0x40, 0x40, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0xc0, 0x38, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0xf6, 0xf6, 0x00, 0x00, 0x30,
                0xf0, 0x80, 0x00, 0x80, 0xf0, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x38, 0xc0, 0x00, 0x00,
                0x00, 0xfc, 0x83, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x8c, 0x8f, 0x8f, 0x8c, 0x80, 0x80,
                0x81, 0x8f, 0x8c, 0x8f, 0x81, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x83, 0xfc, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07,
                0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x00, 0x00, 0x00, 0x00
            },
            { /* upper */
                0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x20, 0xa0, 0xa0, 0xa0, 0xa0, 0xa0, 0x40, 0x40, 0x40, 0x40,
                0x40, 0x40, 0x40, 0x40, 0xa0, 0xa0, 0xa0, 0xa0, 0xa0, 0x20, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0xc0, 0x38, 0xc7, 0xf8, 0xff, 0xff, 0xff, 0xff, 0xf3, 0x03, 0x03, 0xf3, 0xff, 0xc3,
                0x03, 0x3f, 0xff, 0x3f, 0x03, 0xc3, 0xff, 0xff, 0xff, 0xff, 0xf8, 0xc7, 0x38, 0xc0, 0x00, 0x00,
                0x00, 0xfc, 0x83, 0xbc, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xb3, 0xb0, 0xb0, 0xb3, 0xbf, 0xbf,
                0xbc, 0xb0, 0xb3, 0xb0, 0xbc, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xbc, 0x83, 0xfc, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07,
                0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x00, 0x00, 0x00, 0x00
            },
        },
        { /* Layer v */
            { /* lower */
                0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x40, 0x40, 0x40, 0x40,
                0x40, 0x40, 0x40, 0x40, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0xc0, 0x38, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0xf8, 0xc0, 0x00,
                0xc0, 0xf8, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x38, 0xc0, 0x00, 0x00,
                0x00, 0xfc, 0x83, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x87, 0x86,
                0x87, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x83, 0xfc, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07,
                0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x00, 0x00, 0x00, 0x00
            },
            { /* upper */
                0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x20, 0xa0, 0xa0, 0xa0, 0xa0, 0xa0, 0x40, 0x40, 0x40, 0x40,
                0x40, 0x40, 0x40, 0x40, 0xa0, 0xa0, 0xa0, 0xa0, 0xa0, 0x20, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0xc0, 0x38, 0xc7, 0xf8, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xc3, 0x03, 0x3f, 0xff,
                0x3f, 0x03, 0xc3, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0xc7, 0x38, 0xc0, 0x00, 0x00,
                0x00, 0xfc, 0x83, 0xbc, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xbc, 0xb0, 0xb3,
                0xb0, 0xbc, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xbc, 0x83, 0xfc, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07,
                0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x00, 0x00, 0x00, 0x00
            },
        }
    };
    uint32_t curr_layer = get_highest_layer(layer_state);
    led_t led_state = host_keyboard_led_state();
    uint32_t line_number = 0;
    bool require_offset = false;
    /* clear the display */
    for (uint32_t i = 0; i < (OLED_DISPLAY_HEIGHT / 8); i++) {
        oled_set_cursor(0, i);
        oled_advance_page(true);
    }
    /* draw the display */
    for (uint32_t i = 0; i < 5; i++) {
        oled_set_cursor(0, line_number);
        if (i == curr_layer) {
            require_offset = true;
            oled_write_raw(layer_pressed[i][led_state.caps_lock], sizeof(layer_pressed[0][0]));
        } else {
            oled_write_raw(layer_inactive, sizeof(layer_inactive));
        }
        if (require_offset) {
            line_number += 4;
        } else {
            line_number += 3;
        }
        require_offset = false;
    }
}

bool oled_task_user(void) {
    if (!is_keyboard_master()) {
        oled_render_matrix_rain();
    } else {
        oled_render_5layers_state();
    }
    return false;
}
#endif
